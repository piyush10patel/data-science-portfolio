import json
import boto3
import pandas as pd
import math
import random

def either_caller( event ): 
    body=""
    try: # if called by function URL and possibly also HTTP API
        body = json.loads(event['body']) 
    except KeyError: # if called by Test in Lambda or via API Gateway
        body = event # dict
    return body
    

def lambda_handler(event, context):
    body=either_caller( event )
    region = 'us-east-1'
    function_name = 'get_sig_vars9599'
    
    s3_client = boto3.client('s3')
    response_warmup = s3_client.get_object(Bucket='warmupdumps', Key='warmup.json')
    c = response_warmup['Body'].read().decode('utf-8')
    warmup_dict=json.loads(c)
    
    s=warmup_dict['Key1']['s']
    
    try:
        if s=='lambda':
            lambda_client = boto3.client('lambda', region_name=region)
            response = lambda_client.invoke(
                FunctionName=function_name,
                InvocationType='RequestResponse')
            response_payload = response['Payload'].read().decode('utf-8')
            res_data=json.loads(response_payload)
            
            sig_data=pd.DataFrame(res_data)
            sig_var95=sig_data['var95'].mean()
            sig_var99=sig_data['var99'].mean()
            
            return {'var95avg':sig_var95,'var99avg':sig_var99}
        else:
            #ec2 code here
            pass
        
        #return res_data
    except:
        return{'avg':'False'}